import socket
import os
from tqdm import tqdm

if __name__ == '__main__':
    #Define host and port variables
    SEPARATOR = "<SEPARATOR>"
    BUFFER_SIZE = 4096
    my_host = '192.168.43.85'
    my_port = 8080
    
    #Create the socket object
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    
    try:
        #Connect to the server
        sock.connect((my_host, my_port))
        
        #Receive the filename from the server
        data = sock.recv(1024)
        my_filename = data.decode()
        print(f"Received file: {my_filename}")
        
        #Extract the file extension and define local filename
        my_exe = my_filename.split(".")[-1]
        my_home_dir = os.path.expanduser("~")
        my_desktop_path = os.path.join(my_home_dir, "Desktop")
        my_local_filename = os.path.join(my_desktop_path,f"received_file.{my_exe}")
        
        #Open the local file and write the received data
        with open(my_local_filename,"wb") as f:
            while data:
                f.write(data)
                data = sock.recv(1024)
        print(f"Successfully received file at {my_local_filename}")
        
    except Exception as elor:
        print(f"Error receiving file: {elor}")
        
        
        #Close the connection
        
        sock.close()