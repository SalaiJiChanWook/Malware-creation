#File Transfer_Server

import socket
import os
from tqdm import tqdm

if __name__ == '__main__':
    #Define host and port variables
    SEPARATOR = "<SEPARATOR>"
    my_host = '192.168.43.127'
    my_port = 8060
    BUFFER_SIZE = 4096
    
    #Create a socket object
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    
    # Bind the socket to the host and port
    sock.bind((my_host, my_port))
    
    #Listen for connections
    
    sock.listen(1)
    
    
    #Accept a connection
    conn, addr = sock.accept()
    print(f"Connection established with {addr}")
    
    #Get user input for filename
    my_file = input("Enter the filename which you want to send: ")
    
    try:
        #Open the file and send the data
        with open(my_file,'rb') as f:
            #Extract file extension
            my_exe = my_file.split('.')[-1]
            #Send the filename with extension over the socket
            conn.send(f"{my_file}.{my_exe}".encode())
            data = f.read(1024)
            while data:
                conn.send(data)
                data = f.read(1024)
        print(f"Successfully sent {my_file}")
        
    except FileNotFoundError:
        print(f"{my_file} not found. Please enter a valid filename")
    except Exception as elor:
        print(f"Error sending {my_file}: {elor}")
        
    #Close the connection and socket
    
    conn.close()
    sock.close()